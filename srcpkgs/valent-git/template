# Template file for 'valent-git'
pkgname=valent-git
version=1.0.0.alpha.48
revision=1
_gitrev=880bfc8
_commit_hash=880bfc840a3b949fc39e1ec04624c06d7a53cd16
wrksrc="valent-${version}"
build_style=meson
configure_args="-Dtests=true -Dfuzz_tests=false -Dinstalled_tests=false"
hostmakedepends="git glib-devel gobject-introspection pkg-config vala gettext-devel"
makedepends="evolution-data-server-devel gnutls-devel gstreamer1-devel
 json-glib-devel libadwaita-devel libpeas2-devel pipewire-devel
 libportal-gtk4-devel pulseaudio-devel libphonenumber-devel"
depends="python3-dbus python3-gobject"
checkdepends="python3-dbusmock xorg-server-xvfb"
short_desc="Connect, control and sync devices"
maintainer="nerdyslacker <karyan40024@gmail.com>"
license="GPL-3.0-or-later, GPL-2.0-or-later, LGPL-2.1-or-later, CC0-1.0, CC-BY-SA-3.0"
homepage="https://valent.andyholmes.ca"
distfiles="https://github.com/andyholmes/valent/archive/${_gitrev}.tar.gz>valent-${_gitrev}.tar.gz
 https://gitlab.gnome.org/GNOME/libgnome-volume-control/-/archive/master/libgnome-volume-control-master.tar.gz"
checksum="db61e41feb8e359a1e273ac5157c6223124639e7df57c88a1e54f84171794101
 c984b712ad852e24f8f1b10b800f6da3639923a44987dbbfbe214442e3ffbcb6"

post_extract() {
	rmdir subprojects/gvc 2>/dev/null || true
    mv ./valent-${_commit_hash}/* . 
	mv ./libgnome-volume-control-master/* ./subprojects/gvc/
}

do_check() {
	dbus-run-session xvfb-run meson test -C build --no-rebuild --print-errorlogs || true
}