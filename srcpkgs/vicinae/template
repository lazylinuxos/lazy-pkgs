# Template file for 'vicinae'
pkgname=vicinae
version=0.16.10
revision=1
build_style=cmake
configure_args="-G Ninja -DVICINAE_GIT_TAG=v${version} -DCMAKE_BUILD_TYPE=Release"
hostmakedepends="nodejs rapidfuzz-cpp jq protobuf pkg-config"
makedepends="qt6-base-devel qt6-base-private-devel qt6-wayland-devel qt6-wayland-private-devel qt6-svg-devel 
 protobuf-devel cmark-gfm-devel layer-shell-qt-devel libqalculate-devel minizip-devel qtkeychain-qt6-devel"
depends="nodejs qt6-base qt6-wayland qt6-svg protobuf cmark-gfm layer-shell-qt libqalculate minizip qtkeychain-qt6"
short_desc="Focused launcher for your desktop â€” native, fast, extensible"
maintainer="nerdyslacker <karyan40024@gmail.com>"
license="GPL-3.0-only"
homepage="https://github.com/vicinaehq/vicinae"
distfiles="https://github.com/vicinaehq/vicinae/archive/refs/tags/v${version}.tar.gz
 https://api.github.com/repos/vicinaehq/vicinae/git/ref/tags/v${version}>meta.yml"
checksum="308d028c6ac648ad0aadc744bd25edca0fb7aad33712087d46868ba7a8ff7bdc
 65e942ed83c4b52ac16e8bb2b1b02cb9e12b96ab613073ffbe728ef08379a05b"
skip_extraction="meta.yml"

pre_configure() {
	SHA=$(jq .object.sha "${XBPS_SRCDISTDIR}/${pkgname}-${version}/meta.yml" -r)
	configure_args+=" -DVICINAE_GIT_COMMIT_HASH=${SHA:0:7}"
}

post_install() {
    vbin build/vicinae/vicinae vicinae

    vmkdir usr/share/${pkgname}
    vcopy extra/themes/* usr/share/${pkgname}/

    vinstall ${pkgname}/icons/${pkgname}.svg 644 usr/share/icons/hicolor/scalable/apps
    vinstall extra/${pkgname}.desktop 644 usr/share/applications

	rm -rf ${DESTDIR}/usr/lib
	vsv ${pkgname}
	
	# Service doesn't work at this moment, add daemon to autostart 
	vmkdir etc/xdg/autostart
	vinstall ${FILESDIR}/${pkgname}-server.desktop 644 etc/xdg/autostart
}
