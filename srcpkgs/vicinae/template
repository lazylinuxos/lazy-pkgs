# Template file for 'vicinae'
pkgname=vicinae
version=0.15.0
revision=1
build_style=cmake
configure_args="-G Ninja -DVICINAE_GIT_TAG=v${version} -DCMAKE_BUILD_TYPE=Release"
hostmakedepends="nodejs rapidfuzz-cpp jq protobuf pkg-config"
makedepends="qt6-base-devel qt6-base-private-devel qt6-wayland-devel qt6-wayland-private-devel qt6-svg-devel 
 protobuf-devel cmark-gfm-devel layer-shell-qt-devel libqalculate-devel minizip-devel qtkeychain-qt6-devel"
depends="nodejs qt6-base qt6-wayland qt6-svg protobuf cmark-gfm layer-shell-qt libqalculate minizip qtkeychain-qt6"
short_desc="Focused launcher for your desktop â€” native, fast, extensible"
maintainer="nerdyslacker <karyan40024@gmail.com>"
license="GPL-3.0-only"
homepage="https://github.com/vicinaehq/vicinae"
distfiles="https://github.com/vicinaehq/vicinae/archive/refs/tags/v${version}.tar.gz
 https://api.github.com/repos/vicinaehq/vicinae/git/ref/tags/v${version}>meta.yml"
checksum="3dbc16a3b1c5035a836a3110b778b18440b086618ee1b9d5dc655a7bacd63707
 7550acc057547cb030be28dd95d3657622edf9174796e46cd022994e9d5f1990"
skip_extraction="meta.yml"

pre_configure() {
	SHA=$(jq .object.sha "${XBPS_SRCDISTDIR}/${pkgname}-${version}/meta.yml" -r)
	configure_args+=" -DVICINAE_GIT_COMMIT_HASH=${SHA:0:7}"
}

post_install() {
    vbin build/vicinae/vicinae vicinae
    vbin build/wlr-clip/vicinae-wlr-clip vicinae-wlr-clip

    vmkdir usr/share/${pkgname}
    vcopy extra/themes/* usr/share/${pkgname}/

    vinstall ${pkgname}/icons/${pkgname}.svg 644 usr/share/icons/hicolor/scalable/apps
    vinstall extra/${pkgname}.desktop 644 usr/share/applications

	vsv ${pkgname}
	
	# Service doesn't work at this moment, add daemon to autostart 
	vmkdir etc/xdg/autostart
	vinstall ${FILESDIR}/${pkgname}-server.desktop 644 etc/xdg/autostart
}
