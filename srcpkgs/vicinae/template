# Template file for 'vicinae'
pkgname=vicinae
version=0.8.4
revision=1
build_style=cmake
configure_args="-G Ninja -DVICINAE_GIT_TAG=v${version} -DCMAKE_BUILD_TYPE=Release"
hostmakedepends="nodejs rapidfuzz-cpp jq protobuf pkg-config"
makedepends="qt6-base-devel qt6-svg-devel qt6-wayland-devel protobuf-devel cmark-gfm-devel
 layer-shell-qt-devel libqalculate-devel minizip-devel qtkeychain-qt6-devel"
depends="nodejs qt6-base qt6-svg protobuf cmark-gfm layer-shell-qt libqalculate minizip qtkeychain-qt6"
short_desc="Focused launcher for your desktop â€” native, fast, extensible"
maintainer="nerdyslacker <karyan40024@gmail.com>"
license="GPL-3.0-only"
homepage="https://github.com/vicinaehq/vicinae"
distfiles="https://github.com/vicinaehq/vicinae/archive/refs/tags/v${version}.tar.gz
 https://api.github.com/repos/vicinaehq/vicinae/git/ref/tags/v${version}>meta.yml"
checksum="3e353507ade6269451a30ee36671decae31f8e8edc68e18d0177abfdcd54d1cf
 b03d18550e957ecc65613db932f079e33c8aec2770383b6d6e42c08bbd4f10ad"
skip_extraction="meta.yml"

pre_configure() {
	SHA=$(jq .object.sha "${XBPS_SRCDISTDIR}/${pkgname}-${version}/meta.yml" -r)
	configure_args+=" -DVICINAE_GIT_COMMIT_HASH=${SHA:0:7}"
}

post_install() {
    vbin build/vicinae/vicinae vicinae
    vbin build/wlr-clip/vicinae-wlr-clip vicinae-wlr-clip

    vmkdir usr/share/${pkgname}
    vcopy extra/themes/* usr/share/${pkgname}/

    vinstall ${pkgname}/icons/${pkgname}.svg 644 usr/share/icons/hicolor/scalable/apps
    vinstall extra/${pkgname}.desktop 644 usr/share/applications

	vsv ${pkgname}
	
	# Service doesn't work at this moment, add daemon to autostart 
	vmkdir etc/xdg/autostart
	vinstall ${FILESDIR}/${pkgname}-server.desktop 644 etc/xdg/autostart
}
