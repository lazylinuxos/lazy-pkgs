# Template file for 'smile'
pkgname=smile
version=2.10.2
revision=1
build_style=meson
hostmakedepends="pkg-config desktop-file-utils appstream-glib"
makedepends="gtk4-devel libadwaita-devel python3-dbus python3-gobject"
depends="noto-fonts-emoji python3-dbus python3-gobject xdotool wl-clipboard"
short_desc="An emoji picker with custom tags support"
maintainer="nerdyslacker <karyan40024@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://mijorus.it/projects/smile/"
distfiles="https://github.com/mijorus/smile/archive/refs/tags/${version}.tar.gz"
checksum=9edd8e54653e43b6a7eb7fc44721ce918a615082594bdff5204756e35d0c7512

post_extract() {
	# This is not a Flatpak
	sed -i 's|flatpak run {self.application_id}|/usr/bin/smile|g' src/Settings.py
	desktop-file-edit \
		--set-key=Exec --set-value="$pkgname --start-hidden" \
		--set-icon="it.mijorus.smile" \
		"src/assets/$pkgname.autostart.desktop"
}

post_install() {
	# Remove meson.build artifacts not needed
	rm -v ${DESTDIR}/usr/share/icons/hicolor/scalable/actions/meson.build || true
	rm -v ${DESTDIR}/usr/share/${pkgname}/assets/meson.build || true
	rm -v ${DESTDIR}/usr/share/${pkgname}/${pkgname}/meson.build || true
}
